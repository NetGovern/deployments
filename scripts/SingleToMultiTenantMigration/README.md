# Single to MultiTenant Migration procedure

This document outlines the procedure to migrate a single tenant Master configuration to a multi tenant environment.

*Note: Migration of crawler jobs and crawler locations is not supported*

## On the MultiTenant Environment
Deploy a new Master using the deployment scripts as decribed here: <a href="https://bitbucket.netmail.com/projects/PUB/repos/deployments/browse/scripts/AddNewTenant" target="_blank">AddNewTenant</a>  
Run a syncAB to verify connectivity

## On the Single Tenant Master
* Create a Backup of your existing system using the UI:  
    Go to "Netmail Services", then click on the tab "Backup" and select from the section Archiving:

    **Agents and Jobs  
Users**

    The file generated by the UI has to be downloaded and copied to the new Multitenant.

* Based on your current locations configuration, the Case Management folder used by the Remote Provider (Netmail Search) has to be backed up and copied over to a location accessible for the multitenant environment.

* Based on you current locations configuration, the archive data, attachments and audit files have to be copied the multitenant environment, in the shared storage.

* Download the following zip file with the scripts, unzip the content at the same location: 
<a href="https://bitbucket.netmail.com/projects/PUB/repos/deployments/raw/scripts/SingleToMultiTenantMigration/SingleToMulti.zip" target="_blank">SingleToMulti.zip</a> 


## On the new Multitenant Master
* Run the script *Backup.ps1* in powershell.  It will create backups in a folder called *backup*. 
* Restore the backup using the UI, you need to provide the file downloaded from the UI in the single tenant system. 
* Stop the Platform Services
* Run the script called: *CompleteMultitenantRestore.ps1*
* Start the Platform Services
* Go to the UI --> Archiving --> Configuration tab and test the database connectivity.  Save the tab to push the changes to all the jobs.
* Run a syncAB to verify connectivity

* Based on the new location of the archives and Case Management in the shared storage, the locations have to be updated from the UI as well: Archiving --> Storage tab.
When the data is copied, a re-index job is needed to create new indexes in the new server.  This task might take a considerably amount of time, depending on the size of the archives and attachments.

* Verify the Jobs configuration.

* The Remote Provider service can be started at this time, the content shown will depend on the reindex job to finish.