# Azure Application Gateway
This README covers how to deploy an Azure Application Gateway to be used as a frontend gateway for NetGovern Search instances

## Requirements:

* An empty subnet that will be used only by the App. Gateway
* A PFX certificate for SSL terminations


## Deployment:

1. From the Portal, Click on "Create a resource" and type Application Gateway.  
![alt text](./images/app-gateway-1.png "Create Resource")

2. Complete the Basic Settings  
![alt text](./images/app-gateway-2.png "Basic Settings")

3. Choose or create new Virtual Networks and/or subnets  
![alt text](./images/app-gateway-3.png "Settings")

4. Configure the listener and upload the certificate  
![alt text](./images/app-gateway-4.png "HTTPS Listener")

5. Review the summary and create the App. Gateway  
![alt text](./images/app-gateway-5.png "Review")


## Configuration:

1. Navigate to the resource pool where the App. Gateway was deployed and click on it to configure the backends:  
![alt text](./images/app-gateway-6.png "Overview")

2. Click on "Backend Pools" --> "Add Backend Pool" and select the target VM.  It will be the Remote Provider VM from the pod's infrastructure layer:  
![alt text](./images/app-gateway-7.png "Add Backend Pool")

3. Go to "HTTP settings" --> Add.  This is where the destination port is configured (range starts at 8888 by default)  
![alt text](./images/app-gateway-8.png "HTTP Settings")

4. Go to "Rules" --> "Add" in order to associate the backend pool and HTTP setting to the Frontend Listener:  
![alt text](./images/app-gateway-9.png "Rules")

After completing these steps you'll be ready to point the DNS entry to the CNAME generated by Azure.  It can be obtained from:
Frontend IP configurations --> Your public IP address configuration.  
![alt text](./images/app-gateway-10.png "DNS Name")

## Create Additional Listeners
In order to create additional Frontend listeners go to "Listeners" and then choose "Multi-site" to share the same IP (Additional IP addresses can be configured as well).
The following example shows how to add a Multisite Listener in order to reuse the same settings used at the first step (Deployment):  
![alt text](./images/app-gateway-11.png "Add Multisite")

After a new multisite is created, follow the previous steps at the "Configuration" section.

